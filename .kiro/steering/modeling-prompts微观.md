# 建模任务提示词框架

## 概述

本文档提供了一套系统化的提示词框架，用于指导预测建模任务中的关键决策。适用于时间序列预测、回归分析等场景。

---

## 一、额外数据与特征识别提示词

### 1.1 数据需求分析提示词

```
【数据需求分析】

任务背景：{描述预测目标，如"预测2028年各国奥运奖牌数"}

请分析以下维度的数据需求：

1. **核心数据**（必须有）
   - 目标变量的历史数据
   - 时间维度信息
   - 实体标识（如国家代码）

2. **增强数据**（提升预测精度）
   - 经济指标：GDP、人均GDP、GDP增长率、体育预算
   - 人口指标：总人口、年龄结构、城镇化率
   - 体育指标：参赛项目数、运动员数量、历史最佳成绩
   - 政策指标：是否东道国、体育投资政策变化

3. **外部数据源评估**
   对于每个潜在数据源，评估：
   - 可获得性：公开/需申请/付费
   - 时效性：更新频率
   - 覆盖度：是否覆盖所有预测实体
   - 质量：缺失率、准确性

4. **数据关联关系**
   绘制数据实体关系图：
   - 主表：{核心实体}
   - 关联表：{外部数据}
   - 关联键：{year, country_code}

输出格式：
| 数据类型 | 字段名 | 数据源 | 可获得性 | 预期影响 |
|---------|--------|--------|---------|---------|
| 经济 | gdp_per_capita | 世界银行 | 公开 | 高 |
| ... | ... | ... | ... | ... |
```

### 1.2 特征工程提示词

```
【特征工程设计】

基于数据集 {数据描述}，设计以下类型的特征：

1. **时序特征**
   - 滞后特征：lag_1, lag_2, lag_3（前1/2/3期的值）
   - 滚动统计：rolling_mean_3, rolling_std_5（3/5期移动平均/标准差）
   - 趋势特征：growth_rate, acceleration（增长率、加速度）
   - 周期特征：cycle_position（周期位置，如奥运4年周期）

2. **比率特征**
   - 人均指标：medals_per_capita, gdp_per_capita
   - 效率指标：medals_per_event, medals_per_athlete
   - 占比指标：gold_ratio（金牌占比）

3. **交互特征**
   - 乘积交互：gdp × population, investment × events
   - 条件交互：is_host × historical_medals（东道国效应）
   - 比值交互：gdp_growth / population_growth

4. **类别编码**
   - 地区编码：region_onehot（亚洲/欧洲/美洲...）
   - 发展水平：development_level（发达/发展中）
   - 体育强国标识：is_sports_power

5. **聚合特征**
   - 区域聚合：region_avg_medals（区域平均奖牌）
   - 历史聚合：historical_max, historical_min

特征选择原则：
- 避免数据泄露（不使用未来信息）
- 保持可解释性（每个特征有明确含义）
- 控制维度（特征数 < 样本数/10）

输出：特征定义表 + 计算公式 + 预期重要性排序
```

---

## 二、可解释模型选择提示词

### 2.1 模型选择决策提示词

```
【可解释模型选择】

数据特点分析：
- 样本量：{n} 条记录
- 特征数：{p} 个特征
- 时间跨度：{years} 年
- 目标变量分布：{连续/离散/偏态}
- 数据结构：{面板数据/时间序列/横截面}

模型选择矩阵：

| 模型类型 | 适用场景 | 可解释性 | 复杂度 | 推荐度 |
|---------|---------|---------|--------|--------|
| **线性回归** | 线性关系、少量特征 | ⭐⭐⭐⭐⭐ | 低 | 基线模型 |
| **岭回归/Lasso** | 多重共线性、特征选择 | ⭐⭐⭐⭐⭐ | 低 | 高维数据 |
| **决策树** | 非线性、交互效应 | ⭐⭐⭐⭐ | 中 | 规则提取 |
| **随机森林** | 复杂非线性、稳健性 | ⭐⭐⭐ | 中 | 特征重要性 |
| **XGBoost/LightGBM** | 大数据、高精度 | ⭐⭐⭐ | 高 | 竞赛场景 |
| **ARIMA** | 单变量时序、趋势 | ⭐⭐⭐⭐ | 中 | 时序预测 |
| **Prophet** | 多季节性、节假日 | ⭐⭐⭐⭐ | 中 | 业务时序 |
| **GAM** | 非线性+可解释 | ⭐⭐⭐⭐⭐ | 中 | 平滑关系 |

选择原则（按优先级）：
1. 可解释性 > 精度（除非精度差距>10%）
2. 简单模型优先（奥卡姆剃刀）
3. 集成时保留可解释组件

推荐组合策略：
- 基线：线性回归 + 岭回归
- 主力：随机森林 + XGBoost（带SHAP解释）
- 时序：ARIMA + Prophet
- 集成：加权平均（权重可解释）

避免使用：
- 深度神经网络（黑箱）
- 复杂集成（难以解释）
- 过度调参的模型（过拟合风险）
```

### 2.2 模型可解释性增强提示词

```
【模型可解释性增强】

对于选定的模型 {模型名称}，实施以下可解释性措施：

1. **全局解释**
   - 特征重要性排序（基于增益/排列重要性）
   - 部分依赖图（PDP）：展示单特征对预测的边际效应
   - 特征交互图：识别重要的特征组合

2. **局部解释**
   - SHAP值：每个样本每个特征的贡献
   - LIME：局部线性近似解释
   - 反事实解释："如果GDP增加10%，预测会如何变化"

3. **模型简化**
   - 规则提取：从树模型提取决策规则
   - 代理模型：用简单模型近似复杂模型
   - 特征筛选：保留top-k重要特征重新训练

4. **可视化输出**
   - 预测分解图：展示各因素贡献
   - 不确定性可视化：置信区间带
   - 对比图：预测vs实际，按类别分组

输出要求：
- 每个预测附带解释文本
- 关键特征的影响方向和幅度
- 预测置信度评估
```

---

## 三、不确定性估计与误差指标提示词

### 3.1 不确定性建模提示词

```
【不确定性估计建模】

目标：为点预测生成可靠的预测区间

方法选择矩阵：

| 方法 | 原理 | 优点 | 缺点 | 适用场景 |
|------|------|------|------|---------|
| **集成方差法** | 多模型预测的分散度 | 简单快速 | 可能低估 | 已有多模型 |
| **Bootstrap** | 重采样估计分布 | 稳健通用 | 计算量大 | 小样本 |
| **分位数回归** | 直接预测分位数 | 无分布假设 | 需单独训练 | 非对称区间 |
| **贝叶斯方法** | 后验分布采样 | 理论完备 | 实现复杂 | 先验信息丰富 |
| **共形预测** | 校准覆盖率 | 有限样本保证 | 区间可能宽 | 需要覆盖保证 |

推荐实施流程：

1. **基础方法：集成方差**
   ```python
   # 多模型预测
   predictions = {model: model.predict(X) for model in models}
   
   # 点估计
   point_estimate = np.mean(list(predictions.values()), axis=0)
   
   # 区间估计（基于模型间方差）
   std = np.std(list(predictions.values()), axis=0)
   lower = point_estimate - 1.96 * std
   upper = point_estimate + 1.96 * std
   ```

2. **增强方法：Bootstrap**
   ```python
   # 1000次重采样
   bootstrap_preds = []
   for _ in range(1000):
       idx = np.random.choice(n, n, replace=True)
       model.fit(X[idx], y[idx])
       bootstrap_preds.append(model.predict(X_test))
   
   # 分位数区间
   lower = np.percentile(bootstrap_preds, 2.5, axis=0)
   upper = np.percentile(bootstrap_preds, 97.5, axis=0)
   ```

3. **验证方法：覆盖率检验**
   ```python
   # 计算实际覆盖率
   coverage = np.mean((y_true >= lower) & (y_true <= upper))
   # 目标：95%置信区间应覆盖约95%的真值
   ```

不确定性来源分解：
- 模型不确定性（Epistemic）：可通过更多数据减少
- 数据不确定性（Aleatoric）：固有随机性，无法消除
- 输入不确定性：特征本身的测量误差
```

### 3.2 误差指标选择提示词

```
【误差指标体系设计】

指标选择原则：
1. 互补性：不同指标反映不同方面
2. 可解释性：能向非技术人员解释
3. 决策相关性：与业务目标对齐

核心指标体系：

┌─────────────────────────────────────────────────────────┐
│                    误差指标体系                          │
├─────────────────────────────────────────────────────────┤
│  绝对误差类                                              │
│  ├── MAE（平均绝对误差）                                 │
│  │   - 公式：mean(|y_true - y_pred|)                    │
│  │   - 解释："平均每个预测错了X枚奖牌"                   │
│  │   - 优点：直观、对异常值稳健                          │
│  │   - 用途：主要报告指标                                │
│  │                                                       │
│  └── RMSE（均方根误差）                                  │
│      - 公式：sqrt(mean((y_true - y_pred)²))             │
│      - 解释："大误差的惩罚程度"                          │
│      - 优点：惩罚大误差、数学性质好                      │
│      - 用途：模型优化目标                                │
├─────────────────────────────────────────────────────────┤
│  相对误差类                                              │
│  └── MAPE（平均绝对百分比误差）                          │
│      - 公式：mean(|y_true - y_pred| / y_true) × 100%    │
│      - 解释："平均预测偏差百分比"                        │
│      - 优点：可跨规模比较                                │
│      - 注意：y_true=0时无定义                            │
│      - 用途：比较不同规模实体                            │
├─────────────────────────────────────────────────────────┤
│  区间覆盖类                                              │
│  └── Interval Coverage（预测区间覆盖率）                 │
│      - 公式：mean((y_true >= lower) & (y_true <= upper)) │
│      - 解释："95%区间实际覆盖了多少真值"                 │
│      - 目标：接近名义覆盖率（如95%）                     │
│      - 用途：评估不确定性估计质量                        │
├─────────────────────────────────────────────────────────┤
│  拟合优度类                                              │
│  └── R²（决定系数）                                      │
│      - 公式：1 - SS_res / SS_tot                        │
│      - 解释："模型解释了多少变异"                        │
│      - 范围：(-∞, 1]，1为完美拟合                        │
│      - 用途：模型选择、解释力评估                        │
└─────────────────────────────────────────────────────────┘

指标组合使用建议：

场景1：模型开发阶段
- 主指标：RMSE（优化目标）
- 辅助：MAE、R²（监控过拟合）

场景2：模型评估阶段
- 主指标：MAE（整体表现）
- 分层：MAPE（按规模分组）
- 区间：Coverage（不确定性质量）

场景3：结果报告阶段
- 对外：MAE + 预测区间
- 对内：完整指标表 + 分组分析

为什么不合并指标？
1. 信息损失：合并后无法诊断具体问题
2. 权重主观：合并权重难以确定
3. 决策需求不同：不同场景关注不同指标

如果必须合并（如模型排序）：
```python
def composite_score(mae, rmse, coverage, r2):
    """综合评分（仅用于模型排序，不用于报告）"""
    # 归一化到[0,1]，越小越好
    mae_norm = mae / mae_baseline
    rmse_norm = rmse / rmse_baseline
    coverage_penalty = abs(coverage - 0.95)  # 偏离95%的程度
    r2_norm = 1 - r2
    
    # 加权（可根据业务调整）
    return 0.4*mae_norm + 0.3*rmse_norm + 0.2*coverage_penalty + 0.1*r2_norm
```
``